



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://finraos.github.io/herd-mdl/dev-guide/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.5.4">
    
    
      
        <title>Developer guide - Herd-MDL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.css">
      
    
    
      <script src="../assets/javascripts/modernizr.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#build-and-deploy-instructions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a target="_parent" href="https://finraos.github.io/herd-mdl/" title="Herd-MDL" class="md-header-nav__button md-logo">
          
            <img src="../images/herd_logo_large.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Herd-MDL
              </span>
              <span class="md-header-nav__topic">
                Developer guide
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/herd_logo_large.png" width="24" height="24">
      
    </span>
    Herd-MDL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="What is Herd-MDL?" class="md-nav__link">
      What is Herd-MDL?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../basic-install/" title="Basic Install" class="md-nav__link">
      Basic Install
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Developer guide
      </label>
    
    <a href="./" title="Developer guide" class="md-nav__link md-nav__link--active">
      Developer guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Contents </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-build-and-deploy-an-mdl-stack" title="How to build and deploy an MDL stack" class="md-nav__link">
    How to build and deploy an MDL stack
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" title="Steps" class="md-nav__link">
    Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-build-script" title="Running the build-script" class="md-nav__link">
    Running the build-script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../admin-guide/" title="Administration" class="md-nav__link">
      Administration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tech-overview/" title="Technical Overview" class="md-nav__link">
      Technical Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ldap-tree/" title="Users and Groups" class="md-nav__link">
      Users and Groups
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../authorizations-overview/" title="Authorizations and Security" class="md-nav__link">
      Authorizations and Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced-install/" title="Advanced Install" class="md-nav__link">
      Advanced Install
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mdlt/" title="MDLTests (MDLT)" class="md-nav__link">
      MDLTests (MDLT)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tutorials/" title="Tutorials" class="md-nav__link">
      Tutorials
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Contents </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-build-and-deploy-an-mdl-stack" title="How to build and deploy an MDL stack" class="md-nav__link">
    How to build and deploy an MDL stack
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" title="Steps" class="md-nav__link">
    Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-build-script" title="Running the build-script" class="md-nav__link">
    Running the build-script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="build-and-deploy-instructions">Build and deploy instructions<a class="headerlink" href="#build-and-deploy-instructions" title="Permanent link">&para;</a></h1>
<h2 id="how-to-build-and-deploy-an-mdl-stack">How to build and deploy an MDL stack<a class="headerlink" href="#how-to-build-and-deploy-an-mdl-stack" title="Permanent link">&para;</a></h2>
<p>We <em>dockerized</em> our build-and-deploy environment to keep it simple and save you the hassle of installing
 JDK, Maven and Python on your machine. With that being said, if you'd like to use your own development 
environment- please skip the steps below and read the instructions <a href="#running-the-build-script">here</a>.</p>
<h4 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h4>
<ul>
<li>S3-bucket to upload herd-mdl artifacts.</li>
<li>Valid AWS Credentials (for the build script to be able to upload to S3)</li>
<li>Docker installed on your machine</li>
</ul>
<h4 id="steps">Steps<a class="headerlink" href="#steps" title="Permanent link">&para;</a></h4>
<p>1. Clone the herd-mdl repo from GitHub<br />
<code>git clone https://github.com/FINRAOS/herd-mdl.git &amp;&amp; cd herd-mdl</code></p>
<p>2. Switch to the branch you want to deploy<br />
<code>git checkout &lt;branch-name&gt;</code></p>
<p>3. Pull our official docker image from docker-hub <br />
<code>docker pull finraos/herd-mdl</code></p>
<p>4. Navigate to the directory with build scripts  <br />
<code>cd mdl/build/</code></p>
<p>This step is needed because the <em>build-script</em> needs a parameter-file which has default values for
  CloudFormation when bringing up a stack, and this directory has one which you can modify and use.</p>
<p>Verify that the folder-structure looks like this: </p>
<pre class="codehilite"><code>.
├── Dockerfile
├── build_and_deploy.py
├── default-parameters.json
└── env.list</code></pre>


<p>5. Make changes to the <code>env.list</code> file according to your needs, this file gets passed to the docker container as an env-file  </p>
<pre class="codehilite"><code>action=deploy              
build_from=remote          
branch=develop
s3_bucket=s3_bucket_name
s3_bucket_prefix=prefix
default_stack_name=demo-stack
proxy=&lt;proxy-host&gt;          
parameter_file_name=default-parameters.json  
custom_tags=[{'Key': 'CustomKey','Value': 'CustomValue'}]      
local_repo_path=/path/to/your/repo
remote_repo_path=https://github.com/&lt;username&gt;/herd-mdl.git
show_output=True          </code></pre>


<h4 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th><strong>Parameter name</strong></th>
<th><strong>Required</strong></th>
<th><strong>Possible value(s)</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>Y</td>
<td>build <br> deploy</td>
<td>Builds the artifact and upload to S3. <br> Builds, uploads to S3 and launches a new stack.</td>
</tr>
<tr>
<td>build_from</td>
<td>Y</td>
<td>remote <br><br><br> local</td>
<td>Clones remote repository to the container, switches to the specified branch and uses it to build artifacts. <br> Uses your local repository (needs to be mounted to the docker container)</td>
</tr>
<tr>
<td>branch</td>
<td>N</td>
<td>&lt;git branch></td>
<td>The Git branch you want to build artifacts from.</td>
</tr>
<tr>
<td>s3_bucket</td>
<td>N</td>
<td>&lt;s3bucket></td>
<td>Name of the S3 bucket you want to upload the build-artifacts to.</td>
</tr>
<tr>
<td>s3_bucket_prefix</td>
<td>N</td>
<td>&lt;prefix></td>
<td>An optional prefix to use when uploading the build-artifact.</td>
</tr>
<tr>
<td>default_stack_name</td>
<td>Y</td>
<td>&lt;CloudFormation stack-name></td>
<td>The name to use when launching the MDL stack. Please note that there shouldn't be an existing stack with this name or the deployment will fail.</td>
</tr>
<tr>
<td>proxy</td>
<td>N</td>
<td>&lt;proxyhost:port></td>
<td>An optional proxy used by the boto3 client to connect to AWS.</td>
</tr>
<tr>
<td>parameter_file_name</td>
<td>Y</td>
<td>default_parameters_file.json</td>
<td>Name of the parameters file which is used to populate when launching the CloudFormation stack. This could be any valid JSON file with the same format as the one included in the herd-mdl repository [link]</td>
</tr>
<tr>
<td>custom_tags</td>
<td>N</td>
<td>json_array</td>
<td>An optional set of tags you want applied to your CloudFormation stack.</td>
</tr>
<tr>
<td>local_repo_path</td>
<td>N</td>
<td>/path/to/your/local/repo</td>
<td>fully-qualified path to your local repo. Please note that this directory also needs to be mounted on the docker container as a bind-mount.</td>
</tr>
<tr>
<td>remote_repo_path</td>
<td>N</td>
<td>https://remote/repo/location.git</td>
<td>Remote repository location eg: <code>https://github.com/&lt;username&gt;/herd-mdl.git</code></td>
</tr>
<tr>
<td>show_output</td>
<td>N</td>
<td>True <br> False</td>
<td>Show output from system commands <br> Suppress system command outputs</td>
</tr>
</tbody>
</table>
<p>6. Prepare to launch your docker container</p>
<pre class="codehilite"><code>docker create --name &lt;container-name&gt; \
              --env-file env.list \
              --mount=&quot;--mount src=&quot;&lt;local_repo_path&gt;&quot;,target=&quot;&lt;local_repo_path&gt;&quot;,type=bind &quot; \  
              --env AWS_DEFAULT_REGION=&lt;aws_region&gt; \
              --env AWS_ACCESS_KEY_ID=&lt;aws_access_key_id&gt; \
              --env AWS_SECRET_ACCESS_KEY=&lt;aws_secret_access_key&gt; \
              --env AWS_SESSION_TOKEN=&lt;aws_session_token&gt; \
              &lt;image-name&gt;</code></pre>


<blockquote>
<p>Note: The <code>mount</code> option is not required if you're building/deploying from a remote Git location.</p>
</blockquote>
<p>7. Copy the parameters file to the container</p>
<p><code>docker cp default-parameters.json &lt;container-name&gt;:/herd-mdl/default-parameters.json</code></p>
<p>8. Launch the container </p>
<p><code>docker start --interactive &lt;container-name&gt;</code></p>
<blockquote>
<p>Note: The default <em>entrypoint</em> of this docker image runs the build-script. If you want to access to shell: override
  the entrypoint:<br />
<code>docker start -it &lt;container-name&gt; --entrypoint /bin/bash</code></p>
</blockquote>
<p><br></p>
<h3 id="running-the-build-script">Running the build-script<a class="headerlink" href="#running-the-build-script" title="Permanent link">&para;</a></h3>
<p>If you would like to run the <em>build-and-deploy</em> script as a standalone and not use our docker image- please 
follow the instructions below.</p>
<p><strong>Prerequisites</strong></p>
<ul>
<li>JDK 8<br />
<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Download</a></li>
<li>Maven 3.5.4<br />
<a href="https://maven.apache.org/download.cgi">Download</a></li>
<li>Python 3<br />
<a href="https://www.python.org/getit/">Download</a></li>
<li>Install python dependencies<ul>
<li><a href="https://github.com/gitpython-developers/GitPython">GitPython</a></li>
<li><a href="https://github.com/boto/boto3">boto3</a></li>
</ul>
</li>
</ul>
<p><strong>Steps</strong></p>
<p>1. Provide the required/optional parameters to the script as environment variables as needed. Refer to the list of accepted parameters <a href="#parameters">here</a>. </p>
<blockquote>
<p>Examples</p>
<ul>
<li>Linux/OSX: <code>export action=deploy</code></li>
<li>Windows: <code>set action=deploy</code></li>
</ul>
</blockquote>
<p>2. Run the python script.<br />
<code>python3 build_and_deploy.py</code></p>
<p>3. Verify that the stack was launched from your AWS console.</p>
<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<p>1. You don't need to clone herd-mdl if you're only building it from a remote git location.<br />
2. The build script runs some system commands which could generate a lot of output, change the env-var: <code>show_output</code> to <code>False</code> to suppress output.  </p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../user-guide/" title="User Guide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User Guide
              </span>
            </div>
          </a>
        
        
          <a href="../admin-guide/" title="Administration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Administration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>