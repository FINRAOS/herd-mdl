<!--
  Copyright 2018 herd-mdl contributors

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<emrClusterDefinitionCreateRequest>
   <emrClusterDefinitionKey>
      <namespace>MDLT</namespace>
      <emrClusterDefinitionName>MDLTTestCluster</emrClusterDefinitionName>
   </emrClusterDefinitionKey>
   <emrClusterDefinition>
      <sshKeyPairName>$emrKeyPairName</sshKeyPairName>
      <subnetId>$emrClusterSubnets</subnetId>
      <logBucket>s3://$emrClusterLogBucket/EMR/MDLTTestCluster/</logBucket>
      <keepAlive>true</keepAlive>
      <visibleToAll>true</visibleToAll>
      <terminationProtection>true</terminationProtection>
      <encryptionEnabled>false</encryptionEnabled>
      <serviceIamRole>$emrClusterServiceRole</serviceIamRole>
      <ec2NodeIamProfileName>$emrClusterEC2InstanceProfile</ec2NodeIamProfileName>
      <releaseLabel>emr-5.3.1</releaseLabel>
      <instanceDefinitions>
         <masterInstances>
            <instanceCount>1</instanceCount>
            <instanceType>m4.xlarge</instanceType>
         </masterInstances>
      </instanceDefinitions>
      <nodeTags>
         <nodeTag>
            <tagName>Name</tagName>
            <tagValue>MDLTTestCluster</tagValue>
         </nodeTag>
         <nodeTag>
            <tagName>SDLC</tagName>
            <tagValue>QA</tagValue>
         </nodeTag>
         <nodeTag>
            <tagName>Purpose</tagName>
            <tagValue>MATCHING</tagValue>
         </nodeTag>
      </nodeTags>
      <applications>
         <application>
            <name>Hadoop</name>
         </application>
         <application>
            <name>Spark</name>
         </application>
         <application>
            <name>Hbase</name>
         </application>
         <application>
            <name>Ganglia</name>
         </application>
         <application>
            <name>Pig</name>
         </application>
         <application>
            <name>Hive</name>
         </application>
      </applications>
      <configurations>
         <configuration>
            <classification>emrfs-site</classification>
            <properties>
               <property>
                  <name>fs.s3.enableServerSideEncryption</name>
                  <value>true</value>
               </property>
               <property>
                  <name>fs.s3.maxConnections</name>
                  <value>50000</value>
               </property>
               <property>
                  <name>fs.s3.maxRetries</name>
                  <value>15</value>
               </property>
               <property>
                  <name>fs.s3.sleepTimeSeconds</name>
                  <value>15</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>core-site</classification>
            <properties>
               <property>
                  <name>fs.s3n.multipart.uploads.split.size</name>
                  <value>134217728</value>
               </property>
               <property>
                  <name>hadoop.security.key.provider.path</name>
                  <value>kms://http@%{hiera('bigtop::hadoop_head_node')}:%{hiera('hadoop::kms::hadoop_kms_http_port')}/kms</value>
               </property>
               <property>
                  <name>hadoop.security.key.default.bitlength</name>
                  <value>256</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>hbase-env</classification>
            <configurations>
               <configuration>
                  <classification>export</classification>
                  <properties>
                     <property>
                        <name>HBASE_DAEMON_DEFAULT_ROOT_LOGGER</name>
                        <value>INFO,DRFA</value>
                     </property>
                  </properties>
               </configuration>
            </configurations>
         </configuration>
         <configuration>
            <classification>mapred-site</classification>
            <properties>
               <property>
                  <name>mapreduce.map.speculative</name>
                  <value>false</value>
               </property>
               <property>
                  <name>mapreduce.job.reduce.slowstart.completedmaps</name>
                  <value>1.0</value>
               </property>
               <property>
                  <name>mapreduce.reduce.speculative</name>
                  <value>false</value>
               </property>
               <property>
                  <name>mapreduce.job.counters.limit</name>
                  <value>5000</value>
               </property>
               <property>
                  <name>mapreduce.task.timeout</name>
                  <value>900000</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>yarn-site</classification>
            <properties>
               <property>
                  <name>yarn.scheduler.maximum-allocation-mb</name>
                  <value>10240</value>
               </property>
               <property>
                  <name>yarn.nodemanager.resource.memory-mb</name>
                  <value>10240</value>
               </property>
               <property>
                  <name>yarn.web-proxy.address</name>
                  <value />
               </property>
               <property>
                  <name>yarn.log-aggregation-enable</name>
                  <value>true</value>
               </property>
               <property>
                  <name>yarn.nodemanager.remote-app-log-dir</name>
                  <value>/tmp/logs</value>
               </property>
               <property>
                  <name>yarn.log-aggregation.retain-seconds</name>
                  <value>259200</value>
               </property>
               <property>
                  <name>yarn.log-aggregation.retain-check-interval-seconds</name>
                  <value>3600</value>
               </property>
               <property>
                  <name>yarn.nodemanager.vmem-check-enabled</name>
                  <value>false</value>
               </property>
               <property>
                  <name>yarn.nodemanager.vmem-pmem-ratio</name>
                  <value>4</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>hbase-site</classification>
            <properties>
               <property>
                  <name>hbase.master.info.port</name>
                  <value>60010</value>
               </property>
               <property>
                  <name>hbase.master.port</name>
                  <value>60000</value>
               </property>
               <property>
                  <name>hbase.regionserver.port</name>
                  <value>60020</value>
               </property>
               <property>
                  <name>hbase.regionserver.info.port</name>
                  <value>60030</value>
               </property>
               <property>
                  <name>dfs.replication</name>
                  <value>1</value>
               </property>
               <property>
                  <name>hbase.master.wait.on.regionservers.mintostart</name>
                  <value>1</value>
               </property>
               <property>
                  <name>hbase.snapshot.region.timeout</name>
                  <value>18000000</value>
               </property>
               <property>
                  <name>hbase.snapshot.master.timeout.millis</name>
                  <value>18000000</value>
               </property>
               <property>
                  <name>hbase.client.scanner.timeout.period</name>
                  <value>120000</value>
               </property>
               <property>
                  <name>hbase.regionserver.handler.count</name>
                  <value>80</value>
               </property>
               <property>
                  <name>hbase.regionserver.metahandler.count</name>
                  <value>10</value>
               </property>
               <property>
                  <name>hbase.regionserver.regionSplitLimit</name>
                  <value>2147483647</value>
               </property>
               <property>
                  <name>hbase.regionserver.global.memstore.upperLimit</name>
                  <value>0.11</value>
               </property>
               <property>
                  <name>hbase.regionserver.global.memstore.lowerLimit</name>
                  <value>0.1</value>
               </property>
               <property>
                  <name>hbase.regionserver.hlog.blocksize</name>
                  <value>268435456</value>
               </property>
               <property>
                  <name>hbase.hregion.memstore.flush.size</name>
                  <value>268435456</value>
               </property>
               <property>
                  <name>hbase.hregion.memstore.block.multiplier</name>
                  <value>2</value>
               </property>
               <property>
                  <name>hbase.hregion.max.filesize</name>
                  <value>1099511627776</value>
               </property>
               <property>
                  <name>hbase.hstore.compactionThreshold</name>
                  <value>7</value>
               </property>
               <property>
                  <name>hbase.hstore.blockingStoreFiles</name>
                  <value>40</value>
               </property>
               <property>
                  <name>hbase.hstore.compaction.max</name>
                  <value>15</value>
               </property>
               <property>
                  <name>hbase.hregion.majorcompaction</name>
                  <value>0</value>
               </property>
               <property>
                  <name>hfile.block.cache.size</name>
                  <value>0.65</value>
               </property>
               <property>
                  <name>hbase.coprocessor.abortonerror</name>
                  <value>false</value>
               </property>
               <property>
                  <name>hbase.rpc.timeout</name>
                  <value>3600000</value>
               </property>
               <property>
                  <name>hbase.security.authorization</name>
                  <value>false</value>
               </property>
               <property>
                  <name>hbase.hstore.compaction.max.size</name>
                  <value>53687091200</value>
               </property>
               <property>
                  <name>hbase.hstore.compaction.min</name>
                  <value>7</value>
               </property>
               <property>
                  <name>hbase.hstore.compaction.ratio</name>
                  <value />
               </property>
               <property>
                  <name>zookeeper.session.timeout</name>
                  <value>360000</value>
               </property>
               <property>
                  <name>zookeeper.znode.rootserver</name>
                  <value>root-region-server</value>
               </property>
               <property>
                  <name>hbase.zookeeper.property.maxSessionTimeout</name>
                  <value>3600000</value>
               </property>
               <property>
                  <name>hbase.regionserver.thread.compaction.large</name>
                  <value>3</value>
               </property>
               <property>
                  <name>hbase.regionserver.thread.compaction.small</name>
                  <value>1</value>
               </property>
               <property>
                  <name>hbase.block.data.cachecompressed</name>
                  <value>true</value>
               </property>
               <property>
                  <name>hbase.regionserver.region.split.policy</name>
                  <value>org.apache.hadoop.hbase.regionserver.ConstantSizeRegionSplitPolicy</value>
               </property>
               <property>
                  <name>hbase.master.startup.retainassign</name>
                  <value>false</value>
               </property>
               <property>
                  <name>hbase.zookeeper.property.maxClientCnxns</name>
                  <value>10000</value>
               </property>
               <property>
                  <name>hbase.client.sync.wait.timeout.msec</name>
                  <value>2147483647</value>
               </property>
               <property>
                  <name>hbase.balancer.period</name>
                  <value>2147483647</value>
               </property>
               <property>
                  <name>hbase.assignment.usezk</name>
                  <value>false</value>
               </property>
               <property>
                  <name>hbase.balancer.tablesOnMaster</name>
                  <value>hbase:meta</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>hdfs-site</classification>
            <properties>
               <property>
                  <name>dfs.replication</name>
                  <value>1</value>
               </property>
               <property>
                  <name>dfs.encryption.key.provider.uri</name>
                  <value>kms://http@%{hiera('bigtop::hadoop_head_node')}:%{hiera('hadoop::kms::hadoop_kms_http_port')}/kms</value>
               </property>
               <property>
                  <name>dfs.datanode.socket.write.timeout</name>
                  <value>960000</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>hbase-log4j</classification>
            <properties>
               <property>
                  <name>log4j.logger.com.amazon.ws.emr.hadoop.fs.shaded.com.amazonaws.request</name>
                  <value>DEBUG</value>
               </property>
               <property>
                  <name>log4j.logger.com.amazon.ws.emr.hadoop.fs.shaded.com.amazonaws.latency</name>
                  <value>ERROR</value>
               </property>
            </properties>
         </configuration>
         <configuration>
            <classification>hdfs-encryption-zones</classification>
            <properties>
               <property>
                  <name>/</name>
                  <value>root_encryption_key</value>
               </property>
            </properties>
         </configuration>
      </configurations>
   </emrClusterDefinition>
</emrClusterDefinitionCreateRequest>
